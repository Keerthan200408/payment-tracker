<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Tracking App</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <link rel="stylesheet" href="./src/output.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <script>
    window.addEventListener('error', (e) => {
      console.error('Script load failed:', e.message, e.filename);
    });
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    console.log('Starting React app...');
    const { useState, useEffect, useRef } = React;
    const BASE_URL = 'https://payment-tracker-aswa.onrender.com';

    const ErrorBoundary = ({ children }) => {
      const [hasError, setHasError] = useState(false);
      const [error, setError] = useState(null);
      useEffect(() => {
        const errorHandler = (e) => {
          console.error('ErrorBoundary caught:', e.error);
          setHasError(true);
          setError(e.error);
        };
        window.addEventListener('error', errorHandler);
        return () => window.removeEventListener('error', errorHandler);
      }, []);
      if (hasError) {
        return (
          <div className="p-4 bg-red-100 text-red-700 rounded-lg m-4">
            <h2 className="text-xl font-bold">Something went wrong.</h2>
            <p>{error?.toString()}</p>
            <button
              onClick={() => window.location.reload()}
              className="mt-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition"
            >
              Reload Page
            </button>
          </div>
        );
      }
      return children;
    };

    const App = () => {
      const [sessionToken, setSessionToken] = useState(null);
      const [currentUser, setCurrentUser] = useState(null);
      const [page, setPage] = useState('signIn');
      const [clientsData, setClientsData] = useState([]);
      const [paymentsData, setPaymentsData] = useState([]);
      const csvFileInputRef = useRef(null);

      useEffect(() => {
        const storedUser = localStorage.getItem('currentUser');
        const storedToken = localStorage.getItem('sessionToken');
        if (storedUser && storedToken) {
          setCurrentUser(storedUser);
          setSessionToken(storedToken);
          setPage('home');
          fetchClients(storedToken);
          fetchPayments(storedToken);
        }
      }, []);

      const fetchWithRetry = async (url, options, retries = 3) => {
        for (let i = 0; i < retries; i++) {
          try {
            const response = await axios.get(url, options);
            return response;
          } catch (error) {
            if (i === retries - 1) throw error;
            console.log(`Retrying ${url} (${i + 1}/${retries})...`);
            await new Promise(resolve => setTimeout(resolve, 1000));
          }
        }
      };

      const fetchClients = async (token) => {
        try {
          const response = await fetchWithRetry(`${BASE_URL}/api/get-clients`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          setClientsData(response.data);
        } catch (error) {
          console.error('Error fetching clients:', error);
          handleSessionError(error);
        }
      };

      const fetchPayments = async (token) => {
        try {
          const response = await fetchWithRetry(`${BASE_URL}/api/get-payments`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          setPaymentsData(response.data);
        } catch (error) {
          console.error('Error fetching payments:', error);
          handleSessionError(error);
        }
      };

      const handleSessionError = (error) => {
        console.log('Session error:', error.response?.status, error.response?.data);
        if (error.response && error.response.status === 401) {
          logout();
        }
      };

      const logout = () => {
        localStorage.removeItem('currentUser');
        localStorage.removeItem('sessionToken');
        setSessionToken(null);
        setCurrentUser(null);
        setPage('signIn');
        setClientsData([]);
        setPaymentsData([]);
      };

      const importCsv = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (event) => {
          const text = event.target.result;
          const rows = text.split('\n').map(row => row.trim()).filter(row => row);
          if (rows.length === 0) {
            alert('CSV file is empty.');
            csvFileInputRef.current.value = '';
            return;
          }
          const data = rows.map(row => {
            const cols = row.split(',').map(col => col.trim());
            return {
              Client_Name: cols[0] || 'Unknown Client',
              Type: cols[1] || 'Unknown Type',
              Amount_To_Be_Paid: cols[2] || '0',
            };
          });
          try {
            await axios.post(`${BASE_URL}/api/import-csv`, data, {
              headers: { Authorization: `Bearer ${sessionToken}` },
            });
            fetchClients(sessionToken);
            fetchPayments(sessionToken);
            alert('CSV data imported successfully!');
            csvFileInputRef.current.value = '';
          } catch (error) {
            console.error('Error importing CSV:', error);
            alert('Failed to import CSV data: ' + error.message);
            csvFileInputRef.current.value = '';
          }
        };
        reader.readAsText(file);
      };

      console.log('App rendering, page:', page);
      return (
        <div className="min-h-screen bg-gray-50">
          {page === 'signIn' && (
            <SignInPage setSessionToken={setSessionToken} setCurrentUser={setCurrentUser} setPage={setPage} />
          )}
          {page !== 'signIn' && (
            <div className="flex h-screen">
              {/* Sidebar Navigation */}
              <nav className="w-64 bg-indigo-800 text-white flex flex-col p-4">
                <h1 className="text-2xl font-bold mb-8">Payment Tracker</h1>
                <ul>
                  <li>
                    <button
                      onClick={() => setPage('home')}
                      className={`w-full text-left py-3 px-4 rounded-lg mb-2 flex items-center ${page === 'home' ? 'bg-indigo-600' : 'hover:bg-indigo-700'} transition duration-200`}
                    >
                      <i className="fas fa-home mr-3"></i> Dashboard
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => setPage('clients')}
                      className={`w-full text-left py-3 px-4 rounded-lg mb-2 flex items-center ${page === 'clients' ? 'bg-indigo-600' : 'hover:bg-indigo-700'} transition duration-200`}
                    >
                      <i className="fas fa-users mr-3"></i> Clients
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => setPage('addClient')}
                      className={`w-full text-left py-3 px-4 rounded-lg mb-2 flex items-center ${page === 'addClient' ? 'bg-indigo-600' : 'hover:bg-indigo-700'} transition duration-200`}
                    >
                      <i className="fas fa-user-plus mr-3"></i> Add Client
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => setPage('payments')}
                      className={`w-full text-left py-3 px-4 rounded-lg mb-2 flex items-center ${page === 'payments' ? 'bg-indigo-600' : 'hover:bg-indigo-700'} transition duration-200`}
                    >
                      <i className="fas fa-money-bill-wave mr-3"></i> Payments
                    </button>
                  </li>
                  <li>
                    <label className="w-full text-left py-3 px-4 rounded-lg mb-2 flex items-center hover:bg-indigo-700 transition duration-200 cursor-pointer">
                      <i className="fas fa-upload mr-3"></i> Import CSV
                      <input
                        type="file"
                        accept=".csv"
                        onChange={importCsv}
                        ref={csvFileInputRef}
                        className="hidden"
                      />
                    </label>
                  </li>
                  <li>
                    <button
                      onClick={logout}
                      className="w-full text-left py-3 px-4 rounded-lg flex items-center hover:bg-indigo-700 transition duration-200"
                    >
                      <i className="fas fa-sign-out-alt mr-3"></i> Logout
                    </button>
                  </li>
                </ul>
              </nav>
              {/* Main Content */}
              <main className="flex-1 p-8 overflow-y-auto">
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-3xl font-semibold text-gray-800">
                    {page === 'home' ? 'Dashboard' : page === 'clients' ? 'Clients' : page === 'addClient' ? 'Add Client' : 'Payments'}
                  </h2>
                  <div className="text-gray-600">Welcome, {currentUser}</div>
                </div>
                {page === 'home' && (
                  <HomePage clientsData={clientsData} paymentsData={paymentsData} />
                )}
                {page === 'clients' && (
                  <ClientsPage
                    clientsData={clientsData}
                    setPage={setPage}
                    fetchClients={fetchClients}
                    sessionToken={sessionToken}
                    handleSessionError={handleSessionError}
                  />
                )}
                {page === 'addClient' && (
                  <AddClientPage
                    setPage={setPage}
                    fetchClients={fetchClients}
                    sessionToken={sessionToken}
                    handleSessionError={handleSessionError}
                  />
                )}
                {page === 'payments' && (
                  <PaymentsPage
                    paymentsData={paymentsData}
                    fetchPayments={fetchPayments}
                    sessionToken={sessionToken}
                    handleSessionError={handleSessionError}
                  />
                )}
              </main>
            </div>
          )}
        </div>
      );
    };

    const SignInPage = ({ setSessionToken, setCurrentUser, setPage }) => {
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [isLogin, setIsLogin] = useState(true);
      console.log('Rendering SignInPage');
      const handleLogin = async () => {
        try {
          console.log('Attempting login with:', { username, password });
          const response = await axios.post(`${BASE_URL}/api/login`, { username, password });
          console.log('Login response:', response.data);
          setCurrentUser(response.data.username);
          setSessionToken(response.data.sessionToken);
          localStorage.setItem('currentUser', response.data.username);
          localStorage.setItem('sessionToken', response.data.sessionToken);
          setPage('home');
        } catch (error) {
          console.error('Login error:', error.response?.data || error.message);
          alert(error.response?.data?.error || 'Error logging in');
        }
      };
      const handleSignup = async () => {
        try {
          const response = await axios.post(`${BASE_URL}/api/signup`, { username, password });
          alert('Signup successful! Please login.');
          setIsLogin(true);
        } catch (error) {
          alert(error.response?.data?.error || 'Error signing up');
        }
      };
      return (
        <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-indigo-100 to-gray-200">
          <div className="w-full max-w-md p-8 bg-white rounded-xl shadow-lg">
            <h2 className="text-3xl font-bold text-center text-indigo-800 mb-6">
              {isLogin ? 'Login' : 'Sign Up'}
            </h2>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Username</label>
                <input
                  type="text"
                  value={username}
                  onChange={(e) => setUsername(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"
                  placeholder="Enter your username"
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"
                  placeholder="Enter your password"
                />
              </div>
              <button
                onClick={isLogin ? handleLogin : handleSignup}
                className="w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-200 font-semibold"
              >
                {isLogin ? 'Login' : 'Sign Up'}
              </button>
              <p className="text-center text-sm text-gray-600">
                {isLogin ? "Don't have an account?" : 'Already have an account?'}
                <button
                  onClick={() => setIsLogin(!isLogin)}
                  className="text-indigo-600 hover:underline ml-1"
                >
                  {isLogin ? 'Sign Up' : 'Login'}
                </button>
              </p>
            </div>
          </div>
        </div>
      );
    };

    const HomePage = ({ clientsData, paymentsData }) => {
      const totalClients = clientsData.length;
      const totalPaymentsDue = paymentsData.reduce((sum, payment) => sum + (parseFloat(payment[16]) || 0), 0);
      return (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <div className="p-6 bg-white rounded-xl shadow-md hover:shadow-lg transition">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-lg font-semibold text-gray-800">Total Clients</h3>
                <p className="text-3xl font-bold text-indigo-600">{totalClients}</p>
              </div>
              <i className="fas fa-users text-4xl text-indigo-200"></i>
            </div>
          </div>
          <div className="p-6 bg-white rounded-xl shadow-md hover:shadow-lg transition">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-lg font-semibold text-gray-800">Payments Due</h3>
                <p className="text-3xl font-bold text-red-600">₹{totalPaymentsDue.toFixed(2)}</p>
              </div>
              <i className="fas fa-money-bill-wave text-4xl text-red-200"></i>
            </div>
          </div>
          <div className="p-6 bg-white rounded-xl shadow-md hover:shadow-lg transition">
            <div className="flex items-center justify-between">
              <div>
                <h3 className="text-lg font-semibold text-gray-800">Active Subscriptions</h3>
                <p className="text-3xl font-bold text-green-600">{clientsData.filter(c => c[3] === 'subscription').length}</p>
              </div>
              <i className="fas fa-check-circle text-4xl text-green-200"></i>
            </div>
          </div>
        </div>
      );
    };

    const ClientsPage = ({ clientsData, setPage, fetchClients, sessionToken, handleSessionError }) => {
      const [editingClient, setEditingClient] = useState(null);
      const [clientName, setClientName] = useState('');
      const [clientEmail, setClientEmail] = useState('');
      const [clientType, setClientType] = useState('subscription');
      const [monthlyPayment, setMonthlyPayment] = useState('');

      const handleEdit = (client) => {
        setEditingClient(client);
        setClientName(client[1]);
        setClientEmail(client[2]);
        setClientType(client[3]);
        setMonthlyPayment(client[4]);
      };

      const handleUpdate = async () => {
        try {
          await axios.post(`${BASE_URL}/api/update-client`, {
            oldClient: editingClient,
            newClient: [editingClient[0], clientName, clientEmail, clientType, monthlyPayment],
          }, {
            headers: { Authorization: `Bearer ${sessionToken}` },
          });
          setEditingClient(null);
          fetchClients(sessionToken);
        } catch (error) {
          handleSessionError(error);
        }
      };

      const handleDelete = async (client) => {
        if (window.confirm(`Are you sure you want to delete ${client[1]}?`)) {
          try {
            await axios.post(`${BASE_URL}/api/delete-client`, { client }, {
              headers: { Authorization: `Bearer ${sessionToken}` },
            });
            fetchClients(sessionToken);
          } catch (error) {
            handleSessionError(error);
          }
        }
      };

      return (
        <div>
          <div className="overflow-x-auto bg-white rounded-xl shadow-md">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client Name</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monthly Payment</th>
                  <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {clientsData.length === 0 ? (
                  <tr>
                    <td colSpan="5" className="px-6 py-4 text-center text-gray-500">No clients found.</td>
                  </tr>
                ) : (
                  clientsData.map((client, index) => (
                    <tr key={index} className="hover:bg-gray-50 transition">
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{client[1]}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{client[2]}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{client[3]}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹{client[4]}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button
                          onClick={() => handleEdit(client)}
                          className="text-indigo-600 hover:text-indigo-900 mr-4"
                        >
                          <i className="fas fa-edit"></i>
                        </button>
                        <button
                          onClick={() => handleDelete(client)}
                          className="text-red-600 hover:text-red-900"
                        >
                          <i className="fas fa-trash-alt"></i>
                        </button>
                      </td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
          {editingClient && (
            <div className="mt-6 p-6 bg-white rounded-xl shadow-md">
              <h3 className="text-xl font-semibold text-gray-800 mb-4">Edit Client</h3>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                  <input
                    type="text"
                    value={clientName}
                    onChange={(e) => setClientName(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                  <input
                    type="email"
                    value={clientEmail}
                    onChange={(e) => setClientEmail(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
                  <select
                    value={clientType}
                    onChange={(e) => setClientType(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  >
                    <option value="subscription">Subscription</option>
                    <option value="one-time">One-Time</option>
                  </select>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Monthly Payment</label>
                  <input
                    type="number"
                    value={monthlyPayment}
                    onChange={(e) => setMonthlyPayment(e.target.value)}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                  />
                </div>
                <div className="flex space-x-4">
                  <button
                    onClick={handleUpdate}
                    className="flex-1 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-200 font-semibold"
                  >
                    Update Client
                  </button>
                  <button
                    onClick={() => setEditingClient(null)}
                    className="flex-1 py-3 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition duration-200 font-semibold"
                  >
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    const AddClientPage = ({ setPage, fetchClients, sessionToken, handleSessionError }) => {
      const [clientName, setClientName] = useState('');
      const [clientEmail, setClientEmail] = useState('');
      const [clientType, setClientType] = useState('subscription');
      const [monthlyPayment, setMonthlyPayment] = useState('');

      const handleSubmit = async () => {
        try {
          await axios.post(`${BASE_URL}/api/add-client`, {
            client: [null, clientName, clientEmail, clientType, monthlyPayment],
          }, {
            headers: { Authorization: `Bearer ${sessionToken}` },
          });
          fetchClients(sessionToken);
          setPage('clients');
        } catch (error) {
          handleSessionError(error);
        }
      };

      return (
        <div className="p-6 bg-white rounded-xl shadow-md">
          <h3 className="text-xl font-semibold text-gray-800 mb-4">Add New Client</h3>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
              <input
                type="text"
                value={clientName}
                onChange={(e) => setClientName(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="Enter client name"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input
                type="email"
                value={clientEmail}
                onChange={(e) => setClientEmail(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="Enter client email"
              />
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
              <select
                value={clientType}
                onChange={(e) => setClientType(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
              >
                <option value="subscription">Subscription</option>
                <option value="one-time">One-Time</option>
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-1">Monthly Payment</label>
              <input
                type="number"
                value={monthlyPayment}
                onChange={(e) => setMonthlyPayment(e.target.value)}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                placeholder="Enter monthly payment"
              />
            </div>
            <div className="flex space-x-4">
              <button
                onClick={handleSubmit}
                className="flex-1 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-200 font-semibold"
              >
                Add Client
              </button>
              <button
                onClick={() => setPage('clients')}
                className="flex-1 py-3 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition duration-200 font-semibold"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      );
    };

    const PaymentsPage = ({ paymentsData, fetchPayments, sessionToken, handleSessionError }) => {
      const [monthPayments, setMonthPayments] = useState({});
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

      const handlePaymentChange = (index, monthIndex, value) => {
        setMonthPayments(prev => ({
          ...prev,
          [index]: {
            ...prev[index],
            [monthIndex]: value,
          },
        }));
      };

      const handleSavePayments = async () => {
        try {
          const updatedPayments = paymentsData.map((payment, index) => {
            const updatedRow = [...payment];
            for (let i = 0; i < 12; i++) {
              updatedRow[4 + i] = monthPayments[index]?.[i] || payment[4 + i] || '';
            }
            return updatedRow;
          });
          await axios.post(`${BASE_URL}/api/save-payments`, { payments: updatedPayments }, {
            headers: { Authorization: `Bearer ${sessionToken}` },
          });
          fetchPayments(sessionToken);
          setMonthPayments({});
          alert('Payments saved successfully!');
        } catch (error) {
          handleSessionError(error);
        }
      };

      return (
        <div>
          <div className="overflow-x-auto bg-white rounded-xl shadow-md">
            <table className="min-w-full divide-y divide-gray-200">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client Name</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                  {months.map((month, idx) => (
                    <th key={idx} className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{month}</th>
                  ))}
                  <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Due Payment</th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {paymentsData.length === 0 ? (
                  <tr>
                    <td colSpan="16" className="px-6 py-4 text-center text-gray-500">No payments found.</td>
                  </tr>
                ) : (
                  paymentsData.map((payment, index) => (
                    <tr key={index} className="hover:bg-gray-50 transition">
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{payment[1]}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{payment[2]}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹{payment[3]}</td>
                      {months.map((_, monthIndex) => (
                        <td key={monthIndex} className="px-6 py-4 whitespace-nowrap text-sm">
                          <input
                            type="checkbox"
                            checked={
                              (monthPayments[index]?.[monthIndex] !== undefined
                                ? monthPayments[index]?.[monthIndex]
                                : payment[4 + monthIndex]) || false
                            }
                            onChange={(e) => handlePaymentChange(index, monthIndex, e.target.checked)}
                            className="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500"
                          />
                        </td>
                      ))}
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">₹{payment[16]}</td>
                    </tr>
                  ))
                )}
              </tbody>
            </table>
          </div>
          <div className="mt-6 flex justify-end">
            <button
              onClick={handleSavePayments}
              className="py-3 px-6 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-200 font-semibold"
            >
              Save Payments
            </button>
          </div>
        </div>
      );
    };

    ReactDOM.render(
      <ErrorBoundary>
        <App />
      </ErrorBoundary>,
      document.getElementById('root'),
      () => console.log('ReactDOM.render completed')
    );
  </script>
</body>
</html>