<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Tracking App</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.5/Babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
  <link rel="stylesheet" href="./src/output.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Error Boundary Component
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }

      render() {
        if (this.state.hasError) {
          return (
            <div className="p-4 bg-red-100 text-red-700 rounded-lg m-4">
              <h2 className="text-xl font-bold">Something went wrong.</h2>
              <p>{this.state.error?.toString()}</p>
              <button
                onClick={() => window.location.reload()}
                className="mt-2 bg-red-600 text-white px-4 py-2 rounded-lg"
              >
                Reload Page
              </button>
            </div>
          );
        }
        return this.props.children;
      }
    }

    const App = () => {
      const [sessionToken, setSessionToken] = useState(null);
      const [currentUser, setCurrentUser] = useState(null);
      const [page, setPage] = useState('signIn');
      const [clientsData, setClientsData] = useState([]);
      const [paymentsData, setPaymentsData] = useState([]);
      const [isSidebarOpen, setIsSidebarOpen] = useState(false);
      const [contextTargetRow, setContextTargetRow] = useState(null);
      const [filterOptionsVisible, setFilterOptionsVisible] = useState(false);
      const [searchQuery, setSearchQuery] = useState('');
      const [monthFilter, setMonthFilter] = useState('');
      const [statusFilter, setStatusFilter] = useState('');
      const [editClient, setEditClient] = useState(null);
      const csvFileInputRef = useRef(null);

      const BASE_URL = 'https://payment-tracker-aswa.onrender.com';

      useEffect(() => {
        const storedUser = localStorage.getItem('currentUser');
        const storedToken = localStorage.getItem('sessionToken');
        if (storedUser && storedToken) {
          setCurrentUser(storedUser);
          setSessionToken(storedToken);
          fetchClients(storedToken);
          fetchPayments(storedToken);
          setPage('home');
        }
      }, []);

      const fetchClients = async (token) => {
        try {
          const response = await axios.get(`${BASE_URL}/api/get-clients`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          setClientsData(response.data);
        } catch (error) {
          console.error('Error fetching clients:', error);
          handleSessionError(error);
        }
      };

      const fetchPayments = async (token) => {
        try {
          const response = await axios.get(`${BASE_URL}/api/get-payments`, {
            headers: { Authorization: `Bearer ${token}` },
          });
          setPaymentsData(response.data);
        } catch (error) {
          console.error('Error fetching payments:', error);
          handleSessionError(error);
        }
      };

      const handleSessionError = (error) => {
        if (error.response && error.response.status === 401) {
          logout();
        }
      };

      const logout = () => {
        setCurrentUser(null);
        setSessionToken(null);
        localStorage.removeItem('currentUser');
        localStorage.removeItem('sessionToken');
        setClientsData([]);
        setPaymentsData([]);
        setPage('signIn');
      };

      const toggleSidebar = () => setIsSidebarOpen(!isSidebarOpen);

      const handleContextMenu = (e, rowIndex) => {
        e.preventDefault();
        setContextTargetRow({ rowIndex, x: e.pageX, y: e.pageY });
      };

      const hideContextMenu = () => setContextTargetRow(null);

      const deleteRow = async () => {
        if (paymentsData.length <= 1) {
          alert('Cannot delete the last row.');
          hideContextMenu();
          return;
        }
        const rowData = paymentsData[contextTargetRow.rowIndex];
        try {
          await axios.delete(`${BASE_URL}/api/delete-client`, {
            headers: { Authorization: `Bearer ${sessionToken}` },
            data: { Client_Name: rowData.Client_Name, Type: rowData.Type },
          });
          setPaymentsData(paymentsData.filter((_, i) => i !== contextTargetRow.rowIndex));
          setClientsData(clientsData.filter(client => client.Client_Name !== rowData.Client_Name || client.Type !== rowData.Type));
          hideContextMenu();
        } catch (error) {
          console.error('Error deleting row:', error);
          handleSessionError(error);
        }
      };

      const updatePayment = async (rowIndex, month, value) => {
        const updatedPayments = [...paymentsData];
        const rowData = updatedPayments[rowIndex];
        rowData[month] = value;

        const amountToBePaidPerMonth = parseFloat(rowData.Amount_To_Be_Paid) || 0;
        const activeMonths = Object.keys(rowData)
          .filter(key => ['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'].includes(key))
          .filter(m => rowData[m] && parseFloat(rowData[m]) >= 0).length;
        const expectedPayment = amountToBePaidPerMonth * activeMonths;
        const totalPayments = Object.keys(rowData)
          .filter(key => ['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'].includes(key))
          .reduce((sum, m) => sum + (parseFloat(rowData[m]) || 0), 0);
        rowData.Due_Payment = Math.max(expectedPayment - totalPayments, 0).toFixed(2);

        setPaymentsData(updatedPayments);
        try {
          await axios.post(`${BASE_URL}/api/save-payments`, paymentsData, {
            headers: { Authorization: `Bearer ${sessionToken}` },
          });
        } catch (error) {
          console.error('Error saving payments:', error);
          handleSessionError(error);
        }
      };

      const importCsv = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = async (event) => {
          const text = event.target.result;
          const rows = text.split('\n').map(row => row.trim()).filter(row => row);
          if (rows.length === 0) {
            alert('CSV file is empty.');
            csvFileInputRef.current.value = '';
            return;
          }

          const data = rows.map(row => {
            const cols = row.split(',').map(col => col.trim());
            return cols.reduce((obj, val, i) => {
              obj[`col${i}`] = val;
              return obj;
            }, {});
          });

          try {
            await axios.post(`${BASE_URL}/api/import-csv`, data, {
              headers: { Authorization: `Bearer ${sessionToken}` },
            });
            fetchClients(sessionToken);
            fetchPayments(sessionToken);
            alert('CSV data imported successfully!');
            csvFileInputRef.current.value = '';
          } catch (error) {
            console.error('Error importing CSV:', error);
            handleSessionError(error);
            alert('Failed to import CSV data: ' + error.message);
            csvFileInputRef.current.value = '';
          }
        };
        reader.readAsText(file);
      };

      return (
        <div className="min-h-screen bg-gray-100">
          {page === 'signIn' && <SignInPage setSessionToken={setSessionToken} setCurrentUser={setCurrentUser} setPage={setPage} />}
          {page !== 'signIn' && (
            <div className="flex flex-col h-screen">
              <header className="bg-gradient-to-r from-blue-600 to-blue-400 text-white text-xl font-semibold p-4 flex items-center justify-between shadow-lg">
                <div className="flex items-center">
                  <button onClick={toggleSidebar} className="mr-4 focus:outline-none">
                    <i className={`fas fa-${isSidebarOpen ? 'times' : 'bars'} text-xl`}></i>
                  </button>
                  <span>Payment Tracking App</span>
                </div>
              </header>

              <div className="flex flex-1 overflow-hidden">
                <nav className={`bg-gray-800 text-gray-100 w-64 p-4 fixed top-0 h-full transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} z-50`}>
                  <ul className="space-y-2">
                    <li><button onClick={() => { setPage('home'); setIsSidebarOpen(false); }} className="w-full text-left p-2 hover:bg-gray-700 rounded-lg"><i className="fas fa-tachometer-alt mr-2"></i> Dashboard</button></li>
                    <li><button onClick={() => { setPage('clients'); setIsSidebarOpen(false); }} className="w-full text-left p-2 hover:bg-gray-700 rounded-lg"><i className="fas fa-users mr-2"></i> Clients</button></li>
                    <li><button onClick={() => { setPage('payments'); setIsSidebarOpen(false); }} className="w-full text-left p-2 hover:bg-gray-700 rounded-lg"><i className="fas fa-money-bill-wave mr-2"></i> Payments</button></li>
                    <li><button onClick={() => { alert('Reports coming soon!'); setIsSidebarOpen(false); }} className="w-full text-left p-2 hover:bg-gray-700 rounded-lg"><i className="fas fa-chart-line mr-2"></i> Reports</button></li>
                    <li><button onClick={logout} className="w-full text-left p-2 hover:bg-gray-700 rounded-lg text-red-500"><i className="fas fa-sign-out-alt mr-2"></i> Logout</button></li>
                  </ul>
                </nav>
                {isSidebarOpen && <div className="fixed inset-0 bg-black bg-opacity-50 z-40" onClick={toggleSidebar}></div>}

                <main className="flex-1 p-4 overflow-y-auto">
                  {page === 'home' && (
                    <HomePage
                      paymentsData={paymentsData}
                      setPaymentsData={setPaymentsData}
                      searchQuery={searchQuery}
                      setSearchQuery={setSearchQuery}
                      monthFilter={monthFilter}
                      setMonthFilter={setMonthFilter}
                      statusFilter={statusFilter}
                      setStatusFilter={setStatusFilter}
                      filterOptionsVisible={filterOptionsVisible}
                      setFilterOptionsVisible={setFilterOptionsVisible}
                      updatePayment={updatePayment}
                      handleContextMenu={handleContextMenu}
                      contextTargetRow={contextTargetRow}
                      hideContextMenu={hideContextMenu}
                      deleteRow={deleteRow}
                      setPage={setPage}
                      csvFileInputRef={csvFileInputRef}
                      importCsv={importCsv}
                    />
                  )}
                  {page === 'addClient' && (
                    <AddClientPage
                      setPage={setPage}
                      fetchClients={fetchClients}
                      fetchPayments={fetchPayments}
                      sessionToken={sessionToken}
                      currentUser={currentUser}
                      editClient={editClient}
                      setEditClient={setEditClient}
                    />
                  )}
                  {page === 'clients' && (
                    <ClientsPage
                      clientsData={clientsData}
                      setPage={setPage}
                      setEditClient={setEditClient}
                      fetchClients={fetchClients}
                      fetchPayments={fetchPayments}
                      sessionToken={sessionToken}
                    />
                  )}
                  {page === 'payments' && (
                    <PaymentsPage
                      paymentsData={paymentsData}
                      fetchClients={fetchClients}
                      fetchPayments={fetchPayments}
                      sessionToken={sessionToken}
                    />
                  )}
                </main>
              </div>
            </div>
          )}
        </div>
      );
    };

    const SignInPage = ({ setSessionToken, setCurrentUser, setPage }) => {
      const [isSignup, setIsSignup] = useState(false);
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [gmailId, setGmailId] = useState('');
      const BASE_URL = 'https://payment-tracker-aswa.onrender.com';

      const handleLogin = async () => {
        try {
          const response = await axios.post(`${BASE_URL}/api/login`, { username, password });
          setCurrentUser(response.data.username);
          setSessionToken(response.data.sessionToken);
          localStorage.setItem('currentUser', response.data.username);
          localStorage.setItem('sessionToken', response.data.sessionToken);
          setPage('home');
        } catch (error) {
          alert(error.response?.data?.error || 'Error logging in');
        }
      };

      const handleSignup = async () => {
        try {
          await axios.post(`${BASE_URL}/api/signup`, { username, password, gmailId });
          alert('Account created successfully! Please login.');
          setIsSignup(false);
          setUsername('');
          setPassword('');
          setGmailId('');
        } catch (error) {
          alert(error.response?.data?.error || 'Error signing up');
        }
      };

      return (
        <div className="max-w-md mx-auto mt-20 p-6 bg-white rounded-lg shadow-lg">
          <h2 className="text-2xl font-semibold text-center mb-4">
            <i className={`fas fa-${isSignup ? 'user-plus' : 'sign-in-alt'} mr-2`}></i>
            {isSignup ? 'Sign Up' : 'Sign In'}
          </h2>
          {isSignup ? (
            <div>
              <div className="mb-4">
                <label className="block mb-1"><i className="fas fa-user mr-2"></i>Username</label>
                <input type="text" className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value={username} onChange={e => setUsername(e.target.value)} placeholder="Enter username" />
              </div>
              <div className="mb-4">
                <label className="block mb-1"><i className="fas fa-lock mr-2"></i>Password</label>
                <input type="password" className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value={password} onChange={e => setPassword(e.target.value)} placeholder="Enter password" />
              </div>
              <div className="mb-4">
                <label className="block mb-1"><i className="fas fa-envelope mr-2"></i>Gmail ID</label>
                <input type="email" className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value={gmailId} onChange={e => setGmailId(e.target.value)} placeholder="Enter Gmail ID" />
              </div>
              <button onClick={handleSignup} className="w-full bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center justify-center">
                <i className="fas fa-user-plus mr-2"></i> Sign Up
              </button>
              <p className="text-center mt-2">
                Already have an account? <button onClick={() => setIsSignup(false)} className="text-blue-600 hover:underline">Login</button>
              </p>
            </div>
          ) : (
            <div>
              <div className="mb-4">
                <label className="block mb-1"><i className="fas fa-user mr-2"></i>Username</label>
                <input type="text" className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value={username} onChange={e => setUsername(e.target.value)} placeholder="Enter username" />
              </div>
              <div className="mb-4">
                <label className="block mb-1"><i className="fas fa-lock mr-2"></i>Password</label>
                <input type="password" className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" value={password} onChange={e => setPassword(e.target.value)} placeholder="Enter password" />
              </div>
              <button onClick={handleLogin} className="w-full bg-blue-600 text-white p-2 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center justify-center">
                <i className="fas fa-sign-in-alt mr-2"></i> Login
              </button>
              <p className="text-center mt-2">
                Don't have an account? <button onClick={() => setIsSignup(true)} className="text-blue-600 hover:underline">Sign Up</button>
              </p>
            </div>
          )}
        </div>
      );
    };

    const HomePage = ({
      paymentsData, setPaymentsData, searchQuery, setSearchQuery, monthFilter, setMonthFilter, statusFilter, setStatusFilter,
      filterOptionsVisible, setFilterOptionsVisible, updatePayment, handleContextMenu, contextTargetRow, hideContextMenu, deleteRow,
      setPage, csvFileInputRef, importCsv
    }) => {
      const filteredData = paymentsData.filter(row => {
        const clientName = row.Client_Name.toLowerCase();
        const nameMatches = clientName.includes(searchQuery.toLowerCase());
        let filterMatches = true;

        if (monthFilter && statusFilter) {
          const amountToBePaid = parseFloat(row.Amount_To_Be_Paid) || 0;
          const paymentValue = parseFloat(row[monthFilter]) || 0;
          if (statusFilter === 'paid') {
            filterMatches = paymentValue >= amountToBePaid && amountToBePaid > 0;
          } else if (statusFilter === 'unpaid') {
            filterMatches = paymentValue === 0 || !row[monthFilter];
          } else if (statusFilter === 'partially-paid') {
            filterMatches = paymentValue > 0 && paymentValue < amountToBePaid;
          }
        }

        return nameMatches && filterMatches;
      });

      return (
        <div>
          <div className="bg-white p-4 rounded-lg shadow mb-4 flex flex-wrap items-center gap-4">
            <div className="flex gap-2">
              <button onClick={() => setPage('addClient')} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center">
                <i className="fas fa-user-plus mr-2"></i> Add Client
              </button>
              <button onClick={() => csvFileInputRef.current.click()} className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center">
                <i className="fas fa-file-import mr-2"></i> Import CSV
              </button>
              <input type="file" ref={csvFileInputRef} accept=".csv" className="hidden" onChange={importCsv} />
            </div>
            <div className="ml-auto flex items-center gap-2">
              <div className="relative">
                <input
                  type="text"
                  value={searchQuery}
                  onChange={e => setSearchQuery(e.target.value)}
                  placeholder="Search Client Name"
                  className="p-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                />
                <button onClick={() => setSearchQuery('')} className="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                  <i className="fas fa-times"></i>
                </button>
              </div>
              <div className="relative">
                <button onClick={() => setFilterOptionsVisible(!filterOptionsVisible)} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center">
                  <i className="fas fa-filter mr-2"></i> Filter
                </button>
                {filterOptionsVisible && (
                  <div className="absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg p-4 z-50">
                    <div className="mb-4">
                      <label className="block mb-1">Month</label>
                      <select value={monthFilter} onChange={e => setMonthFilter(e.target.value)} className="w-full p-2 border rounded-lg">
                        <option value="">Select Month</option>
                        {['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'].map(month => (
                          <option key={month} value={month}>{month.charAt(0).toUpperCase() + month.slice(1)}</option>
                        ))}
                      </select>
                    </div>
                    <div className="mb-4">
                      <label className="block mb-1">Payment Status</label>
                      <select value={statusFilter} onChange={e => setStatusFilter(e.target.value)} className="w-full p-2 border rounded-lg">
                        <option value="">Select Status</option>
                        <option value="paid">Paid</option>
                        <option value="unpaid">Unpaid</option>
                        <option value="partially-paid">Partially Paid</option>
                      </select>
                    </div>
                    <div className="flex justify-end gap-2">
                      <button onClick={() => { setMonthFilter(''); setStatusFilter(''); setFilterOptionsVisible(false); }} className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">Clear</button>
                      <button onClick={() => setFilterOptionsVisible(false)} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Apply</button>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>

          <div className="overflow-x-auto h-[calc(100vh-200px)]">
            <table className="w-full bg-white rounded-lg shadow">
              <thead>
                <tr className="bg-gray-200 text-center">
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Sr.No</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Client Name</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Type</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Amount To be Paid</th>
                  <th colSpan="12" className="p-2 sticky top-0 bg-gray-200 z-10">Jan - Dec</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Due Payment</th>
                </tr>
                <tr className="bg-gray-200 text-center">
                  <th className="p-2 sticky top-[48px] bg-gray-200 z-10"></th>
                  <th className="p-2 sticky top-[48px] bg-gray-200 z-10"></th>
                  <th className="p-2 sticky top-[48px] bg-gray-200 z-10"></th>
                  <th className="p-2 sticky top-[48px] bg-gray-200 z-10"></th>
                  {['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'].map(month => (
                    <th key={month} className={`p-2 sticky top-[48px] z-10 ${month <= 'june' ? 'bg-blue-50' : 'bg-gray-200'}`}>
                      {month.charAt(0).toUpperCase() + month.slice(1)}
                    </th>
                  ))}
                  <th className="p-2 sticky top-[48px] bg-gray-200 z-10"></th>
                </tr>
              </thead>
              <tbody>
                {filteredData.map((row, index) => (
                  <tr key={index} onContextMenu={e => handleContextMenu(e, index)}>
                    <td className="p-2 text-center">{index + 1}</td>
                    <td className="p-2 text-center">{row.Client_Name}</td>
                    <td className="p-2 text-center">{row.Type}</td>
                    <td className="p-2 text-center">{row.Amount_To_Be_Paid}</td>
                    {['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'].map(month => {
                      const amountToBePaid = parseFloat(row.Amount_To_Be_Paid) || 0;
                      const paymentValue = parseFloat(row[month]) || 0;
                      let cellClass = '';
                      if (!row[month] || paymentValue === 0) cellClass = 'bg-red-100';
                      else if (paymentValue >= amountToBePaid) cellClass = 'bg-green-100';
                      else if (paymentValue > 0) cellClass = 'bg-orange-100';
                      return (
                        <td key={month} className={`p-2 text-center ${month <= 'june' ? 'bg-blue-50' : ''} ${cellClass}`}>
                          <input
                            type="text"
                            value={row[month] || ''}
                            onChange={e => updatePayment(index, month, e.target.value)}
                            className="w-full p-1 border rounded-lg text-center"
                            placeholder={month.charAt(0).toUpperCase() + month.slice(1)}
                          />
                        </td>
                      );
                    })}
                    <td className="p-2 text-center">
                      <input type="text" value={row.Due_Payment} readOnly className="w-full p-1 border rounded-lg text-center bg-gray-100" />
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {contextTargetRow && (
            <div
              className="absolute bg-white border rounded-lg shadow-lg z-50"
              style={{ left: contextTargetRow.x, top: contextTargetRow.y }}
            >
              <button onClick={deleteRow} className="w-full text-left p-2 hover:bg-gray-200">Delete This Row</button>
            </div>
          )}
        </div>
      );
    };

    const AddClientPage = ({ setPage, fetchClients, fetchPayments, sessionToken, currentUser, editClient, setEditClient }) => {
      const [clientName, setClientName] = useState(editClient?.Client_Name || '');
      const [email, setEmail] = useState(editClient?.Email || '');
      const [type, setType] = useState(editClient?.Type || '');
      const [monthlyPayment, setMonthlyPayment] = useState(editClient?.monthly_payment || '');
      const BASE_URL = 'https://payment-tracker-aswa.onrender.com';

      const saveClient = async () => {
        if (!clientName || !type || !monthlyPayment || (editClient && !email)) {
          alert('All fields are required.');
          return;
        }
        const paymentValue = parseFloat(monthlyPayment);
        if (isNaN(paymentValue) || paymentValue <= 0) {
          alert('Monthly payment must be a positive number.');
          return;
        }

        try {
          if (editClient) {
            await axios.put(`${BASE_URL}/api/update-client`, {
              clientName,
              email,
              type,
              monthlyPayment: paymentValue,
              Old_Client_Name: editClient.Client_Name,
              Old_Type: editClient.Type,
            }, {
              headers: { Authorization: `Bearer ${sessionToken}` },
            });
            alert('Client updated successfully!');
          } else {
            await axios.post(`${BASE_URL}/api/add-client`, {
              clientName,
              email,
              type,
              monthlyPayment: paymentValue,
            }, {
              headers: { Authorization: `Bearer ${sessionToken}` },
            });
            alert('Client added successfully!');
          }
          fetchClients(sessionToken);
          fetchPayments(sessionToken);
          setEditClient(null);
          setPage('home');
        } catch (error) {
          console.error('Error saving client:', error);
          alert('Failed to save client: ' + error.message);
        }
      };

      return (
        <div className="max-w-md mx-auto p-6 bg-white rounded-lg shadow-lg">
          <h2 className="text-2xl font-semibold text-center mb-4">
            <i className="fas fa-user-plus mr-2"></i>{editClient ? 'Edit Client' : 'Add New Client'}
          </h2>
          <div className="mb-4">
            <label className="block mb-1"><i className="fas fa-user mr-2"></i>Client Name</label>
            <input type="text" value={clientName} onChange={e => setClientName(e.target.value)} className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter client name" />
          </div>
          <div className="mb-4">
            <label className="block mb-1"><i className="fas fa-envelope mr-2"></i>Client Email</label>
            <input type="email" value={email} onChange={e => setEmail(e.target.value)} className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter client email" />
          </div>
          <div className="mb-4">
            <label className="block mb-1"><i className="fas fa-tag mr-2"></i>Type</label>
            <input type="text" value={type} onChange={e => setType(e.target.value)} className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter type" />
          </div>
          <div className="mb-4">
            <label className="block mb-1"><i className="fas fa-dollar-sign mr-2"></i>Monthly Payment Amount</label>
            <input type="text" value={monthlyPayment} onChange={e => setMonthlyPayment(e.target.value)} className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter amount" />
          </div>
          <div className="flex justify-end gap-2">
            <button onClick={() => { setEditClient(null); setPage('home'); }} className="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 flex items-center">
              <i className="fas fa-times mr-2"></i> Cancel
            </button>
            <button onClick={saveClient} className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center">
              <i className="fas fa-save mr-2"></i> {editClient ? 'Update Client' : 'Add Client'}
            </button>
          </div>
        </div>
      );
    };

    const ClientsPage = ({ clientsData, setPage, setEditClient, fetchClients, fetchPayments, sessionToken }) => {
      const BASE_URL = 'https://payment-tracker-aswa.onrender.com';

      const deleteClient = async (client) => {
        if (!confirm(`Are you sure you want to delete ${client.Client_Name} (${client.Type})?`)) return;
        try {
          await axios.delete(`${BASE_URL}/api/delete-client`, {
            headers: { Authorization: `Bearer ${sessionToken}` },
            data: { Client_Name: client.Client_Name, Type: client.Type },
          });
          fetchClients(sessionToken);
          fetchPayments(sessionToken);
          alert('Client deleted successfully!');
        } catch (error) {
          console.error('Error deleting client:', error);
          alert('Failed to delete client: ' + error.message);
        }
      };

      return (
        <div className="bg-white p-4 rounded-lg shadow">
          <h2 className="text-2xl font-semibold mb-4"><i className="fas fa-users mr-2"></i>Clients</h2>
          <div className="overflow-x-auto h-[calc(100vh-150px)]">
            <table className="w-full">
              <thead>
                <tr className="bg-gray-200 text-center">
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Client Name</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Email</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Monthly Amount</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Actions</th>
                </tr>
              </thead>
              <tbody>
                {clientsData.map((client, index) => (
                  <tr key={index}>
                    <td className="p-2 text-center">{client.Client_Name}</td>
                    <td className="p-2 text-center">{client.Email || 'N/A'}</td>
                    <td className="p-2 text-center">{client.monthly_payment}</td>
                    <td className="p-2 text-center">
                      <button onClick={() => { setEditClient(client); setPage('addClient'); }} className="bg-blue-600 text-white px-2 py-1 rounded-lg hover:bg-blue-700 mr-2">
                        <i className="fas fa-edit mr-1"></i> Edit
                      </button>
                      <button onClick={() => deleteClient(client)} className="bg-red-600 text-white px-2 py-1 rounded-lg hover:bg-red-700">
                        <i className="fas fa-trash-alt mr-1"></i> Delete
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    };

    const PaymentsPage = ({ paymentsData, fetchClients, fetchPayments, sessionToken }) => {
      return (
        <div className="bg-white p-4 rounded-lg shadow">
          <h2 className="text-2xl font-semibold mb-4"><i className="fas fa-money-bill-wave mr-2"></i>Payments</h2>
          <div className="overflow-x-auto h-[calc(100vh-150px)]">
            <table className="w-full">
              <thead>
                <tr className="bg-gray-200 text-center">
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Client Name</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Type</th>
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Amount To be Paid</th>
                  {['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'].map(month => (
                    <th key={month} className="p-2 sticky top-0 bg-gray-200 z-10">{month.charAt(0).toUpperCase() + month.slice(1)}</th>
                  ))}
                  <th className="p-2 sticky top-0 bg-gray-200 z-10">Due Payment</th>
                </tr>
              </thead>
              <tbody>
                {paymentsData.map((payment, index) => (
                  <tr key={index}>
                    <td className="p-2 text-center">{payment.Client_Name}</td>
                    <td className="p-2 text-center">{payment.Type}</td>
                    <td className="p-2 text-center">{payment.Amount_To_Be_Paid}</td>
                    {['january', 'february', 'march', 'april', 'may', 'june', 'july', 'august', 'september', 'october', 'november', 'december'].map(month => (
                      <td key={month} className="p-2 text-center">{payment[month] || ''}</td>
                    ))}
                    <td className="p-2 text-center">{payment.Due_Payment}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    };

    ReactDOM.render(
      <ErrorBoundary>
        <App />
      </ErrorBoundary>,
      document.getElementById('root')
    );
  </script>
</body>
</html>